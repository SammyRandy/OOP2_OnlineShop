<!DOCTYPE html>
<html>
<head>
	<title>Checkout</title>
	<meta name="keywords" content="">
	<meta name="description" content="">
	{{> partials/htmlHead }}
</head>
<body>
{{> partials/header }}

<section class="hero-section position-relative padding-small"
		 style="background-image: url(/images/banner-image-bg-1.jpg); background-size: cover; background-repeat: no-repeat; background-position: center;">
	<div class="hero-content">
		<div class="container">
			<div class="row">
				<div class="text-center">
					<h1>Checkout</h1>
					<div class="breadcrumbs">
						<span class="item">
							<a href="index.html">Home > </a>
						</span>
						<span class="item text-decoration-underline">Checkout</span>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<section class="checkout-wrap padding-medium">
	<div class="container">
		<div class="row d-flex flex-wrap">
			<div class="col-lg-6">
				<h3 class="mb-3">Billing Details</h3>
				<form id="orderForm" class="billing-details">
					<label for="fname">First Name*</label>
					<input type="text" id="fname" name="firstname" class="form-control mt-2 mb-4 ps-3" required>

					<label for="lname">Last Name*</label>
					<input type="text" id="lname" name="lastname" class="form-control mt-2 mb-4 ps-3" required>

					<label for="cname">Company Name (optional)</label>
					<input type="text" id="cname" name="companyname" class="form-control mt-2 mb-4">

					<label for="country">Country / Region*</label>
					<select id="country" name="country" class="form-select form-control mt-2 mb-4" required>
						<option value="" hidden selected>Select your country</option>
						<option value="United States">United States</option>
						<option value="UK">UK</option>
						<option value="Australia">Australia</option>
						<option value="Canada">Canada</option>
					</select>

					<label for="adr1">Street Address*</label>
					<input type="text" id="adr1" name="address" placeholder="House number and street name" class="form-control mt-3 ps-3 mb-3" required>

					<input type="text" id="adr2" name="address2" placeholder="Appartments, suite, etc." class="form-control ps-3 mb-4">

					<label for="city">Town / City *</label>
					<input type="text" id="city" name="city" class="form-control mt-3 ps-3 mb-4" required>

					<label for="state">State *</label>
					<select id="state" name="state" class="form-select form-control mt-2 mb-4" required>
						<option value="" hidden selected>Select your state</option>
						<option value="Florida">Florida</option>
						<option value="New York">New York</option>
						<option value="Chicago">Chicago</option>
						<option value="Texas">Texas</option>
						<option value="San Jose">San Jose</option>
						<option value="Houston">Houston</option>
					</select>

					<label for="zip">Zip Code *</label>
					<input type="text" id="zip" name="zip" class="form-control mt-2 mb-4 ps-3" required>

					<label for="phone">Phone *</label>
					<input type="text" id="phone" name="phone" class="form-control mt-2 mb-4 ps-3" required>

					<label for="email">Email address *</label>
					<input type="email" id="email" name="email" class="form-control mt-2 mb-4 ps-3" required>

					<button type="submit" name="submit" class="btn" onclick="validateAndSubmit(event)">Place an order</button>
				</form>
			</div>
			<div class="col-lg-6">
				<div>
					<h3 class="mb-3">Additional Information</h3>
					<div class="billing-details">
						<label for="fname">Order notes (optional)</label>
						<textarea class="form-control pt-3 pb-3 ps-3 mt-2"
								  placeholder="Notes about your order. Like special notes for delivery."></textarea>
					</div>
				</div>

				<div class="cart-totals padding-medium pb-0">
					<h3 class="mb-3">Cart Totals</h3>
					<div class="articles-list mt-3">
						<h4>Articles</h4>
						<table cellspacing="0" class="table text-capitalize">
							<thead>
							<tr>
								<th>Image</th>
								<th>Name</th>
								<th>Price</th>
								<th>Quantity</th>
							</tr>
							</thead>
							<tbody>
							{{#cartItems}}
							<tr>
								<td><img src="{{image}}" alt="{{name}}" style="width:50px;height:50px;"></td>
								<td>{{name}}</td>
								<td><span class="price-currency-symbol">$</span>{{price}}</td>
								<td>{{quantity}}</td>
							</tr>
							{{/cartItems}}
							</tbody>
						</table>
					</div>
					<div class="total-price pb-3">
						<table cellspacing="0" class="table text-capitalize">
							<tbody>
							<tr class="subtotal pt-2 pb-2 border-top border-bottom">
								<th>Subtotal</th>
								<td data-title="Subtotal">
									<span class="price-amount amount text-primary ps-5 fw-light">
										<bdi>
											<span class="price-currency-symbol">$</span>{{cartSubtotalPrice}}
										</bdi>
									</span>
								</td>
							</tr>
							<tr class="order-total pt-2 pb-2 border-bottom">
								<th>Total</th>
								<td data-title="Total">
									<span class="price-amount amount text-primary ps-5 fw-light">
										<bdi>
											<span class="price-currency-symbol">$</span>{{cartTotalPrice}}</bdi>
									</span>
								</td>
							</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="list-group">
					<label class="list-group-item d-flex gap-2 border-0">
						<input class="form-check-input flex-shrink-0" type="radio" name="listGroupRadios"
							   id="listGroupRadios1" value="" checked>
						<span>
							<p class="mb-1">Direct bank transfer</p>
							<small>Make your payment directly into our bank account. Please use your Order ID. Your order will
								shipped after funds have cleared in our account.</small>
						</span>
					</label>
					<label class="list-group-item d-flex gap-2 border-0">
						<input class="form-check-input flex-shrink-0" type="radio" name="listGroupRadios"
							   id="listGroupRadios2" value="">
						<span>
							<p class="mb-1">Check payments</p>
							<small>Please send a check to Store Name, Store Street, Store Town, Store State / County, Store
								Postcode.</small>
						</span>
					</label>
					<label class="list-group-item d-flex gap-2 border-0">
						<input class="form-check-input flex-shrink-0" type="radio" name="listGroupRadios"
							   id="listGroupRadios3" value="">
						<span>
							<p class="mb-1">Cash on delivery</p>
							<small>Pay with cash upon delivery.</small>
						</span>
					</label>
					<label class="list-group-item d-flex gap-2 border-0">
						<input class="form-check-input flex-shrink-0" type="radio" name="listGroupRadios"
							   id="listGroupRadios3" value="">
						<span>
							<p class="mb-1">Paypal</p>
							<small>Pay via PayPal; you can pay with your credit card if you donâ€™t have a PayPal account.</small>
						</span>
					</label>
				</div>
			</div>
		</div>
	</div>
</section>

<script>

	document.addEventListener('DOMContentLoaded', (event) => {
		let orderCount = 0

		async function SubmitOrder() {
			orderCount++;
			localStorage.setItem('orderCount', orderCount);

			const billingDetails = {
				firstname: document.getElementById('fname').value,
				lastname: document.getElementById('lname').value,
				companyname: document.getElementById('cname').value,
				country: document.getElementById('country').value,
				address: document.getElementById('adr1').value,
				address2: document.getElementById('adr2').value,
				city: document.getElementById('city').value,
				state: document.getElementById('state').value,
				zip: document.getElementById('zip').value,
				phone: document.getElementById('phone').value,
				email: document.getElementById('email').value
			};
			console.log(billingDetails)

			try {

				var cartResponse = await fetch('/api/cart');
				var cart = await cartResponse.json();


				let response = await fetch('/api/addCartToOrder', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(billingDetails)
				});

				if (response.ok) {
					console.log('Cart added to Order successfully!');
					response.json().then(data => {
						console.log(data); // Print the response body
						orderCount = parseInt(data)
						window.location.href = `/order.html?orderCount=${orderCount}`;
					});


				} else {
					console.error('Failed to add Cart to Order');
				}
			} catch (error) {
				console.error('Error:', error);
			}
		}

		function validateAndSubmit(event) {
			event.preventDefault();
			const form = document.getElementById('orderForm');

			if (form.checkValidity()) {
				SubmitOrder();
			} else {
				form.reportValidity();
			}
		}

		window.validateAndSubmit = validateAndSubmit;
	});
</script>

{{> partials/footer }}
</body>
</html>
